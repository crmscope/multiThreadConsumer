## Общий принцип работы.

Модуль настраивается через файл **kafka_config.yaml**, в котором задаются общие параметры и конфигурация топиков (секция **topics**). Количество блоков, описанных в этой секции, определяет число процессов (goroutines) с консьюмерами, которые будут запущены.

В каждом блоке секции **topics** указываются следующие параметры:

 **name** — имя топика  
 **groupId** — идентификатор группы  
 **worker** — имя воркера


#### Рекомендации согласно документации Kafka:

 Все консьюмеры, подключённые к одному топику, должны использовать одну и ту же группу (groupId).

 Количество консьюмеров должно соответствовать числу партиций в топике.


#### Принцип работы:

Консьюмеры считывают данные из Kafka и передают их в воркеры. Чтобы избежать искажения информации, каждый пакет предварительно кодируется в формате Base64.



## Конфигурация.
**kafka_config.yaml.dist** — пример файла конфина находящийся в репазитории. Для запуска консьюмера нужно скопировать фал в  **kafka_config.yaml** со своими настройками.

## Компиляция и запуск.

Команды выполняются в корневом каталоге:

##### Запуск скрипта на песочнице. 
Данная команда используется для дебага. При таком запуске код не компелируется.
```
$ sh kafka_consumer.sh start
```

##### Запуск скрипта на проде: 
```
$ sh kafka_consumer.sh start_prod
```

##### Корректное завершение:
```
$ sh kafka_consumer.sh stop
```

##### Некорректное завершение:
```
$ sh kafka_consumer.sh kill
```

### Компиляция

Компиляция в бинарный файл выполняется в папке с исходником:
```
$ cd custom/include/MultiThreadsConsumer/cmd/app
$ go build -o main
```
После этого обновиться бинарный файл main


## Файлы логов.
**Файл с PID демона:** 
```
/var/run/crm/ bitrix_exchange_daemon.pid 
```
**Файл лога демона:** 
```
/var/log/crm/bitrix_exchange.log 
```
**Файлы логов потоков:** 
```
/var/log/crm/bitrix_exchange.log.1.log 
```
Каждый поток пишет в свой файл полученную из Kafka информацию.



## Тестирование.
